<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timezone Converter</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        .tz-flex { display:flex; gap:1rem; align-items:center; flex-wrap:wrap }
        .result { margin-top: 1rem; padding:1rem; border:1px solid var(--pico-muted-border-color); border-radius:var(--pico-border-radius); background:var(--pico-card-background-color) }
        .small-note { font-size:0.9rem; color:var(--pico-muted-color) }
        .tz-list { max-height: 260px; overflow:auto; }
        a { color: #6b8dd6; }
        a.back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-weight: bold;
            padding: 0.4rem 0.6rem;
            border-radius: var(--pico-border-radius);
            transition: all 0.2s;
            color: #6b8dd6;
        }
        a.back-link:hover {
            background-color: rgba(107, 141, 214, 0.1);
            color: #5b7dc6;
        }
        button { background-color: #6b8dd6; border-color: #6b8dd6; color: white; }
        button:hover { background-color: #5b7dc6; border-color: #5b7dc6; }
        button:disabled { background-color: #9baee6; border-color: #9baee6; opacity: 0.6; }
    </style>
</head>
<body>
    <main class="container">
        <p style="margin-bottom: 1rem;"><a href="index.html" class="back-link">‚Üê Back to Tools</a></p>
        <hgroup>
            <h1>Timezone converter üïí</h1>
            <p>Convert a date/time from one IANA timezone to another and inspect DST.</p>
        </hgroup>

        <section class="panel" id="tz-converter">
            <label>
                Date & time (leave empty to use current date/time)
                <input type="datetime-local" id="dtInput">
            </label>

            <div class="tz-flex">
                <label>
                    From
                    <select id="fromTz" class="tz-list"></select>
                </label>

                <label>
                    To
                    <select id="toTz" class="tz-list"></select>
                </label>

                <button id="convertTzBtn">Convert</button>
            </div>

            <div class="result" id="tzResult" aria-live="polite"></div>
            <p class="small-note">DST detection: If the timezone observes DST, the tool will indicate whether the provided date falls within DST for the selected zone.</p>

            <p style="margin-top:1rem"><a href="index.html" class="back-link">‚Üê Back to Tools</a></p>
        </section>
    </main>

    <script>
        // Helpers
        function populateTimeZones(selects) {
            const list = (typeof Intl.supportedValuesOf === 'function')
                ? Intl.supportedValuesOf('timeZone')
                : [
                    'UTC','Etc/GMT','America/New_York','America/Chicago','America/Denver','America/Los_Angeles',
                    'Europe/London','Europe/Paris','Europe/Berlin','Asia/Tokyo','Asia/Shanghai','Asia/Kolkata','Australia/Sydney'
                  ];

            list.forEach(tz => {
                selects.forEach(sel => {
                    const opt = document.createElement('option');
                    opt.value = tz;
                    opt.textContent = tz;
                    sel.appendChild(opt);
                });
            });

            // Set defaults
            const local = Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC';
            selects.forEach(sel => { sel.value = local; });
        }

        function tzOffsetMinutes(date, timeZone) {
            const f = new Intl.DateTimeFormat('en-US', {
                timeZone,
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
            });
            const parts = f.formatToParts(date).reduce((acc, p) => {
                if (p.type !== 'literal') acc[p.type] = p.value;
                return acc;
            }, {});

            const asUTC = Date.UTC(parts.year, parts.month - 1, parts.day, parts.hour, parts.minute, parts.second);
            const utcMs = date.getTime();
            const offsetMin = (utcMs - asUTC) / (60 * 1000);
            return Math.round(offsetMin);
        }

        function formatInTimeZone(date, timeZone, opts = {}) {
            const fmt = new Intl.DateTimeFormat(undefined, Object.assign({
                timeZone,
                year:'numeric', month:'short', day:'2-digit',
                hour:'2-digit', minute:'2-digit', second:'2-digit'
            }, opts));
            return fmt.format(date);
        }

        function getDSTInfo(date, timeZone) {
            const jan = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
            const jul = new Date(Date.UTC(date.getUTCFullYear(), 6, 1));
            const offJan = tzOffsetMinutes(jan, timeZone);
            const offJul = tzOffsetMinutes(jul, timeZone);
            const offDate = tzOffsetMinutes(date, timeZone);

            const usesDST = offJan !== offJul;
            const dstOffset = Math.min(offJan, offJul);
            const inDST = usesDST && offDate === dstOffset;

            return { usesDST, inDST, offsetMin: offDate };
        }

        // Parse a datetime-local string to components
        function parseLocalDatetimeLocal(value) {
            if (!value) return null;
            const parts = value.split('T');
            if (parts.length !== 2) return null;
            const [y,m,d] = parts[0].split('-').map(Number);
            const timeParts = parts[1].split(':').map(Number);
            const [hour, minute, second = 0] = timeParts;
            return { y, m, d, hour, minute, second };
        }

        function dateTimeInZoneToInstant(components, timeZone) {
            const utcCandidate = Date.UTC(components.y, components.m - 1, components.d, components.hour, components.minute, components.second);
            const approxDate = new Date(utcCandidate);
            const offsetMin = tzOffsetMinutes(approxDate, timeZone);
            const instantMs = utcCandidate - (offsetMin * 60 * 1000);
            return new Date(instantMs);
        }

        function convertTimezone() {
            const dtVal = document.getElementById('dtInput').value;
            const from = document.getElementById('fromTz').value;
            const to = document.getElementById('toTz').value;
            const result = document.getElementById('tzResult');

            const now = new Date();
            let instant;
            if (!dtVal) {
                instant = now;
            } else {
                const comp = parseLocalDatetimeLocal(dtVal);
                if (!comp) { result.textContent = 'Invalid date/time'; return; }
                instant = dateTimeInZoneToInstant(comp, from);
            }

            const srcFmt = formatInTimeZone(instant, from);
            const dstFmt = formatInTimeZone(instant, to);

            const dstInfo = getDSTInfo(instant, to);
            result.innerHTML = `
                <strong>Source (${from}):</strong> ${srcFmt}<br>
                <strong>Target (${to}):</strong> ${dstFmt}<br>
                <strong>UTC:</strong> ${instant.toISOString()}<br>
                <strong>Target offset:</strong> ${dstInfo.offsetMin} minutes<br>
                <strong>Uses DST:</strong> ${dstInfo.usesDST ? 'Yes' : 'No'}<br>
                <strong>In DST on that date:</strong> ${dstInfo.inDST ? 'Yes' : 'No'}
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateTimeZones([document.getElementById('fromTz'), document.getElementById('toTz')]);
            document.getElementById('convertTzBtn').addEventListener('click', convertTimezone);
            document.getElementById('dtInput').addEventListener('keyup', (e) => { if (e.key === 'Enter') convertTimezone(); });
        });
    </script>
</body>
</html>
